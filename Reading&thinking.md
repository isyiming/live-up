## 高并发系统三大策略保护系统稳定

### 缓存

    提升系统访问速度
    增大系统最大处理容量

### 降级

    在高峰流量来临时，暂时关闭非核心符合，系统全力处理高峰流量的请求

### 限流

    对并发请求的数量进行控制，防止系统瘫痪

    可限制的目标：
      总并发数，这个就是由系统性能决定的
      瞬时并发数
      时间窗口内平均速率
      远程接口的调用速率
      网络链接数
      网络流量
      CPU
      内存负载


    计数器
      简单粗暴，超过设定指标阈值直接拒绝请求
    令牌桶
      令牌就令牌，还非得说桶，什么时候见过令牌放到桶里的了。我想换一种方式描述令牌桶。
      假设我们（用户）在公园喂猴子（系统）爆米花（请求）。
      工作人员（限流控制）就按照固定速率往一个桶里扔爆米花。
      桶满了就掉到地上，他也不嫌浪费，爆米花不是他家的不要钱。
      我们不断的把桶里的爆米花丢给猴子，猴子不断的处理我们的请求。
      这个过程，猴子能够处理的请求的最大值就是桶的容量（总并发数）。
      在桶的容量限度以内，这个瞬时并发数就是我们的手速决定的了。
      如果用户请求一直是一个非常频繁呢？那么猴子的瞬时并发数就是一个固定的值，就是工作人员扔爆米花的速率。
      令牌桶限制了总并发数，不能控制瞬时并发数，但是最大瞬时并发这个状态是没办法维持住的，只能出现那么一下。
      令牌桶的处理请求速率可以是这样的：
          -              -
          -              -
         - -------      -  
      ---         ------

    漏桶

    我们再用喂猴子这个例子来说下漏桶吧。
    由于新冠疫情的影响，公园禁止我们直接喂猴子了。另外，爆米花公园不再提供了，我们自备。
    我们热情不减，还是不断的隔着栅栏往桶里扔爆米花（请求），桶满了就溢出来了。
    工作人员还是那个人浮于事的工作人员，他就懒懒散散的从桶里取爆米花扔喂给猴子（系统）。
    这个过程中，猴子处理请求的最大值就是工作人员的手速。
    漏桶限制了总并发数，也限制了瞬时并发数。      
       - -------      -  
    ---         ------

有的博客说漏桶和令牌桶的效果是一样的，我觉得完全不一样。如果我们的服务器就没多大容量，平时业务也不多，还没钱，比如学校的教务管理。那就应该用漏桶。限制总并发，限制瞬时并发。
  要是我们的系统可以动态扩容，那么就可以用令牌桶。当预计流量高峰到来的时候，提前扩容。

大部分限流方法应该都是基于这三种基本策略吧，实际应用肯定要根据情况调整。

    就令牌桶来讲，既然允许了瞬时并发数的突增，那么投放令牌的速率就可以根据瞬时并发数改变呀。
    瞬时并发数大了，说明用户请求多了，可以反馈控制令牌投放的快一点。
